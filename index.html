<!DOCTYPE html>
<html lang="en">
<head profile="http://www.w3.org/2005/10/profile">
  <link href="https://fonts.googleapis.com/css?family=Lato:100,200,300,400,700,900" rel="stylesheet">
  <meta name="Description" content="Author: Lukasz Szczepanski, Copyrights: Lukasz Szczepanski">
  <title>szczepan.me</title>
  <link rel="icon" type="image/png" href="images/szczepan_ico.png"/>
  <link rel="stylesheet" href="./css/styles.css" media="screen">
  <script>let exports = {}</script>
  <script src="js/libraries/paper-js/paper-full.min.js" defer></script>
  <script src="js/libraries/ogl/ogl-bundle.js"></script>
  <script src="./js/index.js" type="module" defer></script>
  <script type="module">
		const imgSize = [1900, 1259];
		const vertex = `
					attribute vec2 uv;
					attribute vec2 position;
					varying vec2 vUv;
					void main() {
							vUv = uv;
							gl_Position = vec4(position, 0, 1);
					}
			`;
		const fragment = `
				precision highp float;
				precision highp int;
				uniform sampler2D tWater;
				uniform sampler2D tFlow;
				uniform float uTime;
				varying vec2 vUv;
				uniform vec4 res;
				void main() {
						// R and G values are velocity in the x and y direction
						// B value is the velocity length
						vec3 flow = texture2D(tFlow, vUv).rgb;
						vec2 uv = .5 * gl_FragCoord.xy / res.xy ;
						vec2 myUV = (uv - vec2(0.5))*res.zw + vec2(0.5);
						myUV -= flow.xy * (0.15 * 0.7);
						vec2 myUV2 = (uv - vec2(0.5))*res.zw + vec2(0.5);
						myUV2 -= flow.xy * (0.125 * 0.7);
						vec2 myUV3 = (uv - vec2(0.5))*res.zw + vec2(0.5);
						myUV3 -= flow.xy * (0.10 * 0.7);
						vec3 tex = texture2D(tWater, myUV).rgb;
						vec3 tex2 = texture2D(tWater, myUV2).rgb;
						vec3 tex3 = texture2D(tWater, myUV3).rgb;
            gl_FragColor = vec4(tex.r, tex2.g, tex3.b, 1.0);
				}
			`;
		{
			const renderer = new ogl.Renderer({ dpr: 2 });
			const gl = renderer.gl;
			document.body.appendChild(gl.canvas);

			// Variable inputs to control flowmap
			let aspect = 1;
			const mouse = new ogl.Vec2(-1);
			const velocity = new ogl.Vec2();
			function resize() {
				let a1, a2;
				var imageAspect = imgSize[1] / imgSize[0];
				if (window.innerHeight / window.innerWidth < imageAspect) {
					a1 = 1;
					a2 = window.innerHeight / window.innerWidth / imageAspect;
				} else {
					a1 = (window.innerWidth / window.innerHeight) * imageAspect;
					a2 = 1;
				}
				mesh.program.uniforms.res.value = new ogl.Vec4(
					window.innerWidth,
					window.innerHeight,
					a1,
					a2
				);

				renderer.setSize(window.innerWidth, window.innerHeight);
				aspect = window.innerWidth / window.innerHeight;
			}
			const flowmap = new ogl.Flowmap(gl, {
				falloff: 1.0, // size of the stamp, percentage of the size
				alpha: 0.3, // opacity of the stamp
				dissipation: 0.94 // affects the speed that the stamp fades. Closer to 1 is slower
			});
			// Triangle that includes -1 to 1 range for 'position', and 0 to 1 range for 'uv'.
			const geometry = new ogl.Geometry(gl, {
				position: {
					size: 2,
					data: new Float32Array([-1, -1, 3, -1, -1, 3])
				},
				uv: { size: 2, data: new Float32Array([0, 0, 2, 0, 0, 2]) }
			});

			const texture = new ogl.Texture(gl, {
				minFilter: gl.LINEAR,
				magFilter: gl.LINEAR
			});
			const img = new Image();
			img.onload = () => (texture.image = img);
			img.crossOrigin = "Anonymous";
			img.src = "./images/wallpaper-1900x1259.jpg";

			let a1, a2;
			var imageAspect = imgSize[1] / imgSize[0];
			if (window.innerHeight / window.innerWidth < imageAspect) {
				a1 = 1;
				a2 = window.innerHeight / window.innerWidth / imageAspect;
			} else {
				a1 = (window.innerWidth / window.innerHeight) * imageAspect;
				a2 = 1;
			}

			const program = new ogl.Program(gl, {
				vertex,
				fragment,
				uniforms: {
					uTime: { value: 0 },
					tWater: { value: texture },
					res: {
						value: new ogl.Vec4(window.innerWidth, window.innerHeight, a1, a2)
					},
					img: { value: new ogl.Vec2(imgSize[0], imgSize[1]) },
					// Note that the uniform is applied without using an object and value property
					// This is because the class alternates this texture between two render targets
					// and updates the value property after each render.
					tFlow: flowmap.uniform
				}
			});
			const mesh = new ogl.Mesh(gl, { geometry, program });

			window.addEventListener("resize", resize, false);
			resize();

			// Create handlers to get mouse position and velocity
			const isTouchCapable = "ontouchstart" in window;
			if (isTouchCapable) {
				window.addEventListener("touchstart", updateMouse, false);
				window.addEventListener("touchmove", updateMouse, { passive: false });
			} else {
				window.addEventListener("mousemove", updateMouse, false);
			}
			let lastTime;
			const lastMouse = new ogl.Vec2();
			function updateMouse(e) {
				e.preventDefault();
				if (e.changedTouches && e.changedTouches.length) {
					e.x = e.changedTouches[0].pageX;
					e.y = e.changedTouches[0].pageY;
				}
				if (e.x === undefined) {
					e.x = e.pageX;
					e.y = e.pageY;
				}
				// Get mouse value in 0 to 1 range, with y flipped
				mouse.set(e.x / gl.renderer.width, 1.0 - e.y / gl.renderer.height);
				// Calculate velocity
				if (!lastTime) {
					// First frame
					lastTime = performance.now();
					lastMouse.set(e.x, e.y);
				}

				const deltaX = e.x - lastMouse.x;
				const deltaY = e.y - lastMouse.y;

				lastMouse.set(e.x, e.y);

				let time = performance.now();

				// Avoid dividing by 0
				let delta = Math.max(10.4, time - lastTime);
				lastTime = time;
				velocity.x = deltaX / delta;
				velocity.y = deltaY / delta;
				// Flag update to prevent hanging velocity values when not moving
				velocity.needsUpdate = true;
			}
			requestAnimationFrame(update);
			function update(t) {
				requestAnimationFrame(update);
				// Reset velocity when mouse not moving
				if (!velocity.needsUpdate) {
					mouse.set(-1);
					velocity.set(0);
				}
				velocity.needsUpdate = false;
				// Update flowmap inputs
				flowmap.aspect = aspect;
				flowmap.mouse.copy(mouse);
				// Ease velocity input, slower when fading out
				flowmap.velocity.lerp(velocity, velocity.len ? 0.15 : 0.1);
				flowmap.update();
				program.uniforms.uTime.value = t * 0.01;
				renderer.render({ scene: mesh });
			}
		}
  </script>
  <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0">
</head>
<body>
<div class="outer full-height active">
  <main class="flex-grid-container">
    <div class="grid-container full-fill">
      <div class="item"></div>
      <div class="item"></div>
      <div class="item"></div>
      <div class="item"></div>
    </div>
    <div class="flex-grid-item"></div>
    <div class="flex-grid-item content translate--y">
      <figure class="inner active">
        <svg xmlns="http://www.w3.org/2000/svg">
          <use class="logo" xlink:href="svg/all.svg#logo">
          </use>
          <use class="was" xlink:href="svg/all.svg#was">
          </use>
        </svg>
      </figure>
      <h1 class="hello">Hello.</h1>
      <h2 class="comingSoon">My name is Lukasz and I am a
        <br/>
        <span class="glitch role" data-text=" ">UI Developer.</span>
      </h2>
      <nav class="navigation">
        <a class="more shake-little" rel="noopener" target="_blank" href="https://github.com/lukasz81">
          <span class="text indent">Visit Github website </span>
          <figure class="github">
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#github"></use>
            </svg>
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#github"></use>
            </svg>
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#github"></use>
            </svg>
          </figure>
        </a>
        <a class="more shake-little" rel="noopener" target="_blank" href="https://www.behance.net/szczepan">
          <span class="text indent">Visit Behance website</span>
          <figure class="behance">
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#behance"></use>
            </svg>
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#behance"></use>
            </svg>
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#behance"></use>
            </svg>
          </figure>
        </a>

        <a class="more shake-little" rel="noopener" target="_blank" href="https://twitter.com/szczeps81">
          <span class="text indent">Follow me on Twitter</span>
          <figure class="twitter">
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#twitter"></use>
            </svg>
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#twitter"></use>
            </svg>
            <svg>
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="svg/all.svg#twitter"></use>
            </svg>
          </figure>
        </a>
      </nav>
    </div>
    <div class="flex-grid-item tooltip-container">
      <div class="tooltip-wrapper">
        <div class="tooltip">
          <p id="tooltip-text">
            <span id="action-type">Click </span>to change the mood !
          </p>
          <svg version="1.1" id="panel" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
               x="0px" y="0px" viewBox="0 0 300 96" style="enable-background:new 0 0 300 96;" xml:space="preserve">
                        <style type="text/css">
                        	.shape {
                            fill: url(#SVGID_1_);
                          }
                        </style>
            <g>
	                        <radialGradient id="SVGID_1_" cx="150" cy="42" r="110.0402" gradientUnits="userSpaceOnUse">
	                	        <stop offset="0" style="stop-color:var(--gradient-two);stop-opacity:0.28"/>
                            <stop offset="0.9791" style="stop-color:var(--gradient-two);stop-opacity:5.698085e-03"/>
                            <stop offset="0.9995" style="stop-color:var(--gradient-two);stop-opacity:0"/>
	                        </radialGradient>
              <path class="shape"
                    d="M300,83.4 161.8,83.4 150,95.4 137.5,83.4 0,83.4 0,12.6 137.5,12.6 150,12.6 161.8,12.6 300,12.6 z"/>
                        </g>
            <path class="line-up" d="M0,12.6 137.5,12.6 150,12.6 161.8,12.6 300,12.6 "/>
            <path class="line-down" d="M0,83.4 137.5,83.4 150,95.4 161.8,83.4 300,83.4 "/>
                    </svg>
        </div>
      </div>
    </div>
    <div class="flex-grid-item flex mood-actions active">
      <span class="heart"></span>
      <div class="spinner">
        <span class="glitch shake-little shake-constant" data-text="RELOADING">RELOADING</span>
      </div>
    </div>
  </main>
  <canvas id="myCanvas" resize></canvas>
</div>
</body>
</html>
